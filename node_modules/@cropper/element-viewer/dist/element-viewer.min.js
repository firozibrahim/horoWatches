!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CropperViewer={})}(this,(function(e){"use strict";const t="undefined"!=typeof window&&void 0!==window.document,s=t?window:{};t&&s.document.documentElement;const o="cropper",n=`${o}-canvas`,i=`${o}-image`,a=`${o}-selection`,r=`${o}-viewer`,c="load",h="change",l="transform",d=Number.isNaN||s.isNaN;const u=/([a-z\d])([A-Z])/g;function m(e){return String(e).replace(u,"$1-$2").toLowerCase()}const g=/-[A-z\d]/g;function $(e){return e.replace(g,(e=>e.slice(1).toUpperCase()))}const f=/\s\s*/;function b(e,t,s,o){t.trim().split(f).forEach((t=>{e.removeEventListener(t,s,o)}))}function p(e,t,s,o){t.trim().split(f).forEach((t=>{e.addEventListener(t,s,o)}))}const S={bubbles:!0,cancelable:!0,composed:!0};const y=Promise.resolve();const w=/left|top|width|height/i,C="open",I=new WeakMap,v=new WeakMap,E=new Map,T=s.document&&Array.isArray(s.document.adoptedStyleSheets)&&"replaceSync"in s.CSSStyleSheet.prototype;class k extends HTMLElement{get $sharedStyle(){return(this.themeColor?`:host{--theme-color: ${this.themeColor};}`:"")+":host([hidden]){display:none!important}"}constructor(){var e,t;super(),this.shadowRootMode=C,this.slottable=!0;const s=null===(t=null===(e=Object.getPrototypeOf(this))||void 0===e?void 0:e.constructor)||void 0===t?void 0:t.$name;s&&E.set(s,this.tagName.toLowerCase())}static get observedAttributes(){return["shadow-root-mode","slottable","theme-color"]}attributeChangedCallback(e,t,s){if(Object.is(s,t))return;const o=$(e);let n=s;switch(typeof this[o]){case"boolean":n=null!==s&&"false"!==s;break;case"number":n=Number(s)}switch(this[o]=n,e){case"theme-color":{const e=v.get(this),t=this.$sharedStyle;e&&t&&(T?e.replaceSync(t):e.textContent=t);break}}}$propertyChangedCallback(e,t,s){if(!Object.is(s,t))switch(e=m(e),typeof s){case"boolean":!0===s?this.hasAttribute(e)||this.setAttribute(e,""):this.removeAttribute(e);break;case"number":s=d(s)?"":String(s);default:s?this.getAttribute(e)!==s&&this.setAttribute(e,s):this.removeAttribute(e)}}connectedCallback(){Object.getPrototypeOf(this).constructor.observedAttributes.forEach((e=>{const t=$(e);let s=this[t];(function(e){return void 0===e})(s)||this.$propertyChangedCallback(t,void 0,s),Object.defineProperty(this,t,{enumerable:!0,configurable:!0,get:()=>s,set(e){const o=s;s=e,this.$propertyChangedCallback(t,o,e)}})}));const e=this.attachShadow({mode:this.shadowRootMode||C});if(this.shadowRoot||I.set(this,e),v.set(this,this.$addStyles(this.$sharedStyle)),this.$style&&this.$addStyles(this.$style),this.$template){const t=document.createElement("template");t.innerHTML=this.$template,e.appendChild(t.content)}if(this.slottable){const t=document.createElement("slot");e.appendChild(t)}}disconnectedCallback(){v.has(this)&&v.delete(this),I.has(this)&&I.delete(this)}$getTagNameOf(e){var t;return null!==(t=E.get(e))&&void 0!==t?t:e}$setStyles(e){return Object.keys(e).forEach((t=>{let s=e[t];(function(e){return"number"==typeof e&&!d(e)})(s)&&(s=0!==s&&w.test(t)?`${s}px`:String(s)),this.style[t]=s})),this}$getShadowRoot(){return this.shadowRoot||I.get(this)}$addStyles(e){let t;const s=this.$getShadowRoot();return T?(t=new CSSStyleSheet,t.replaceSync(e),s.adoptedStyleSheets=s.adoptedStyleSheets.concat(t)):(t=document.createElement("style"),t.textContent=e,s.appendChild(t)),t}$emit(e,t,s){return function(e,t,s,o){return e.dispatchEvent(new CustomEvent(t,Object.assign(Object.assign(Object.assign({},S),{detail:s}),o)))}(this,e,t,s)}$nextTick(e){return function(e,t){return t?y.then(e?t.bind(e):t):y}(this,e)}static $define(e,o){var n;"object"==typeof(n=e)&&null!==n&&(o=e,e=""),e||(e=this.$name||this.name),e=m(e),t&&s.customElements&&!s.customElements.get(e)&&customElements.define(e,this,o)}}k.$version="2.0.0-beta.4";const O=new WeakMap,A=new WeakMap,N=new WeakMap,L="both",j="horizontal",x="vertical",R="none";class M extends k{constructor(){super(...arguments),this.$onSelectionChange=null,this.$onSourceImageLoad=null,this.$onSourceImageTransform=null,this.$scale=1,this.$style=":host{display:block;height:100%;overflow:hidden;position:relative;width:100%}",this.resize=x,this.selection="",this.slottable=!1}set $image(e){O.set(this,e)}get $image(){return O.get(this)}set $sourceImage(e){N.set(this,e)}get $sourceImage(){return N.get(this)}set $selection(e){A.set(this,e)}get $selection(){return A.get(this)}static get observedAttributes(){return super.observedAttributes.concat(["resize","selection"])}connectedCallback(){super.connectedCallback();let e=null;if(e=this.selection?this.ownerDocument.querySelector(this.selection):this.closest(this.$getTagNameOf(a)),"object"==typeof(t=e)&&null!==t&&1===t.nodeType){this.$selection=e,this.$onSelectionChange=this.$handleSelectionChange.bind(this),p(e,h,this.$onSelectionChange);const t=e.closest(this.$getTagNameOf(n));if(t){const e=t.querySelector(this.$getTagNameOf(i));e&&(this.$sourceImage=e,this.$image=e.cloneNode(!0),this.$getShadowRoot().appendChild(this.$image),this.$onSourceImageLoad=this.$handleSourceImageLoad.bind(this),this.$onSourceImageTransform=this.$handleSourceImageTransform.bind(this),p(e.$image,c,this.$onSourceImageLoad),p(e,l,this.$onSourceImageTransform))}this.$render()}var t}disconnectedCallback(){const{$selection:e,$sourceImage:t}=this;e&&this.$onSelectionChange&&(b(e,h,this.$onSelectionChange),this.$onSelectionChange=null),t&&this.$onSourceImageLoad&&(b(t.$image,c,this.$onSourceImageLoad),this.$onSourceImageLoad=null),t&&this.$onSourceImageTransform&&(b(t,l,this.$onSourceImageTransform),this.$onSourceImageTransform=null),super.disconnectedCallback()}$handleSelectionChange(e){this.$render(e.detail)}$handleSourceImageLoad(){const{$image:e,$sourceImage:t}=this,s=e.getAttribute("src"),o=t.getAttribute("src");o&&o!==s&&(e.setAttribute("src",o),e.$ready((()=>{setTimeout((()=>{const{x:e,y:s}=this.$selection;this.$transformImageByOffset(t.$getTransform(),-e,-s)}))})))}$handleSourceImageTransform(e){const{x:t,y:s}=this.$selection;this.$transformImageByOffset(e.detail.matrix,-t,-s)}$render(e){const{x:t,y:s,width:o,height:n}=e||this.$selection,i={},{clientWidth:a,clientHeight:r}=this;let c=a,h=r,l=NaN;switch(this.resize){case L:l=1,c=o,h=n,i.width=o,i.height=n;break;case j:l=r/n,c=o*l,i.width=c;break;case x:l=a/o,h=n*l,i.height=h;break;default:a>0?l=a/o:r>0&&(l=r/n)}this.$scale=l,this.$setStyles(i),this.$sourceImage&&this.$transformImageByOffset(this.$sourceImage.$getTransform(),-t,-s)}$transformImageByOffset(e,t,s){const{$image:o,$scale:n,$sourceImage:i}=this;if(i&&o&&n>0){const[i,a,r,c,h,l]=e,d=(t*c-r*s)/(i*c-r*a),u=(s-a*d)/c,m=i*d+r*u+h,g=a*d+c*u+l;o.$ready((e=>{this.$setStyles.call(o,{width:e.naturalWidth*n,height:e.naturalHeight*n})})),o.$setTransform(i,a,r,c,m*n,g*n)}}}M.$name=r,M.$version="2.0.0-beta.4",e.RESIZE_BOTH=L,e.RESIZE_HORIZONTAL=j,e.RESIZE_NONE=R,e.RESIZE_VERTICAL=x,e.default=M,Object.defineProperty(e,"__esModule",{value:!0})}));
