const e="undefined"!=typeof window&&void 0!==window.document,t=e?window:{};e&&t.document.documentElement;const s="cropper",o=`${s}-canvas`,n=`${s}-image`,i=`${s}-selection`,a=`${s}-viewer`,r="load",h="change",c="transform",l=Number.isNaN||t.isNaN;const d=/([a-z\d])([A-Z])/g;function u(e){return String(e).replace(d,"$1-$2").toLowerCase()}const m=/-[A-z\d]/g;function $(e){return e.replace(m,(e=>e.slice(1).toUpperCase()))}const g=/\s\s*/;function b(e,t,s,o){t.trim().split(g).forEach((t=>{e.removeEventListener(t,s,o)}))}function f(e,t,s,o){t.trim().split(g).forEach((t=>{e.addEventListener(t,s,o)}))}const p={bubbles:!0,cancelable:!0,composed:!0};const S=Promise.resolve();const y=/left|top|width|height/i,w="open",C=new WeakMap,v=new WeakMap,I=new Map,k=t.document&&Array.isArray(t.document.adoptedStyleSheets)&&"replaceSync"in t.CSSStyleSheet.prototype;class T extends HTMLElement{get $sharedStyle(){return(this.themeColor?`:host{--theme-color: ${this.themeColor};}`:"")+":host([hidden]){display:none!important}"}constructor(){var e,t;super(),this.shadowRootMode=w,this.slottable=!0;const s=null===(t=null===(e=Object.getPrototypeOf(this))||void 0===e?void 0:e.constructor)||void 0===t?void 0:t.$name;s&&I.set(s,this.tagName.toLowerCase())}static get observedAttributes(){return["shadow-root-mode","slottable","theme-color"]}attributeChangedCallback(e,t,s){if(Object.is(s,t))return;const o=$(e);let n=s;switch(typeof this[o]){case"boolean":n=null!==s&&"false"!==s;break;case"number":n=Number(s)}switch(this[o]=n,e){case"theme-color":{const e=v.get(this),t=this.$sharedStyle;e&&t&&(k?e.replaceSync(t):e.textContent=t);break}}}$propertyChangedCallback(e,t,s){if(!Object.is(s,t))switch(e=u(e),typeof s){case"boolean":!0===s?this.hasAttribute(e)||this.setAttribute(e,""):this.removeAttribute(e);break;case"number":s=l(s)?"":String(s);default:s?this.getAttribute(e)!==s&&this.setAttribute(e,s):this.removeAttribute(e)}}connectedCallback(){Object.getPrototypeOf(this).constructor.observedAttributes.forEach((e=>{const t=$(e);let s=this[t];(function(e){return void 0===e})(s)||this.$propertyChangedCallback(t,void 0,s),Object.defineProperty(this,t,{enumerable:!0,configurable:!0,get:()=>s,set(e){const o=s;s=e,this.$propertyChangedCallback(t,o,e)}})}));const e=this.attachShadow({mode:this.shadowRootMode||w});if(this.shadowRoot||C.set(this,e),v.set(this,this.$addStyles(this.$sharedStyle)),this.$style&&this.$addStyles(this.$style),this.$template){const t=document.createElement("template");t.innerHTML=this.$template,e.appendChild(t.content)}if(this.slottable){const t=document.createElement("slot");e.appendChild(t)}}disconnectedCallback(){v.has(this)&&v.delete(this),C.has(this)&&C.delete(this)}$getTagNameOf(e){var t;return null!==(t=I.get(e))&&void 0!==t?t:e}$setStyles(e){return Object.keys(e).forEach((t=>{let s=e[t];(function(e){return"number"==typeof e&&!l(e)})(s)&&(s=0!==s&&y.test(t)?`${s}px`:String(s)),this.style[t]=s})),this}$getShadowRoot(){return this.shadowRoot||C.get(this)}$addStyles(e){let t;const s=this.$getShadowRoot();return k?(t=new CSSStyleSheet,t.replaceSync(e),s.adoptedStyleSheets=s.adoptedStyleSheets.concat(t)):(t=document.createElement("style"),t.textContent=e,s.appendChild(t)),t}$emit(e,t,s){return function(e,t,s,o){return e.dispatchEvent(new CustomEvent(t,Object.assign(Object.assign(Object.assign({},p),{detail:s}),o)))}(this,e,t,s)}$nextTick(e){return function(e,t){return t?S.then(e?t.bind(e):t):S}(this,e)}static $define(s,o){var n;"object"==typeof(n=s)&&null!==n&&(o=s,s=""),s||(s=this.$name||this.name),s=u(s),e&&t.customElements&&!t.customElements.get(s)&&customElements.define(s,this,o)}}T.$version="2.0.0-beta.4";const O=new WeakMap,A=new WeakMap,E=new WeakMap,L="both",N="horizontal",j="vertical",x="none";class M extends T{constructor(){super(...arguments),this.$onSelectionChange=null,this.$onSourceImageLoad=null,this.$onSourceImageTransform=null,this.$scale=1,this.$style=":host{display:block;height:100%;overflow:hidden;position:relative;width:100%}",this.resize=j,this.selection="",this.slottable=!1}set $image(e){O.set(this,e)}get $image(){return O.get(this)}set $sourceImage(e){E.set(this,e)}get $sourceImage(){return E.get(this)}set $selection(e){A.set(this,e)}get $selection(){return A.get(this)}static get observedAttributes(){return super.observedAttributes.concat(["resize","selection"])}connectedCallback(){super.connectedCallback();let e=null;if(e=this.selection?this.ownerDocument.querySelector(this.selection):this.closest(this.$getTagNameOf(i)),"object"==typeof(t=e)&&null!==t&&1===t.nodeType){this.$selection=e,this.$onSelectionChange=this.$handleSelectionChange.bind(this),f(e,h,this.$onSelectionChange);const t=e.closest(this.$getTagNameOf(o));if(t){const e=t.querySelector(this.$getTagNameOf(n));e&&(this.$sourceImage=e,this.$image=e.cloneNode(!0),this.$getShadowRoot().appendChild(this.$image),this.$onSourceImageLoad=this.$handleSourceImageLoad.bind(this),this.$onSourceImageTransform=this.$handleSourceImageTransform.bind(this),f(e.$image,r,this.$onSourceImageLoad),f(e,c,this.$onSourceImageTransform))}this.$render()}var t}disconnectedCallback(){const{$selection:e,$sourceImage:t}=this;e&&this.$onSelectionChange&&(b(e,h,this.$onSelectionChange),this.$onSelectionChange=null),t&&this.$onSourceImageLoad&&(b(t.$image,r,this.$onSourceImageLoad),this.$onSourceImageLoad=null),t&&this.$onSourceImageTransform&&(b(t,c,this.$onSourceImageTransform),this.$onSourceImageTransform=null),super.disconnectedCallback()}$handleSelectionChange(e){this.$render(e.detail)}$handleSourceImageLoad(){const{$image:e,$sourceImage:t}=this,s=e.getAttribute("src"),o=t.getAttribute("src");o&&o!==s&&(e.setAttribute("src",o),e.$ready((()=>{setTimeout((()=>{const{x:e,y:s}=this.$selection;this.$transformImageByOffset(t.$getTransform(),-e,-s)}))})))}$handleSourceImageTransform(e){const{x:t,y:s}=this.$selection;this.$transformImageByOffset(e.detail.matrix,-t,-s)}$render(e){const{x:t,y:s,width:o,height:n}=e||this.$selection,i={},{clientWidth:a,clientHeight:r}=this;let h=a,c=r,l=NaN;switch(this.resize){case L:l=1,h=o,c=n,i.width=o,i.height=n;break;case N:l=r/n,h=o*l,i.width=h;break;case j:l=a/o,c=n*l,i.height=c;break;default:a>0?l=a/o:r>0&&(l=r/n)}this.$scale=l,this.$setStyles(i),this.$sourceImage&&this.$transformImageByOffset(this.$sourceImage.$getTransform(),-t,-s)}$transformImageByOffset(e,t,s){const{$image:o,$scale:n,$sourceImage:i}=this;if(i&&o&&n>0){const[i,a,r,h,c,l]=e,d=(t*h-r*s)/(i*h-r*a),u=(s-a*d)/h,m=i*d+r*u+c,$=a*d+h*u+l;o.$ready((e=>{this.$setStyles.call(o,{width:e.naturalWidth*n,height:e.naturalHeight*n})})),o.$setTransform(i,a,r,h,m*n,$*n)}}}M.$name=a,M.$version="2.0.0-beta.4";export{L as RESIZE_BOTH,N as RESIZE_HORIZONTAL,x as RESIZE_NONE,j as RESIZE_VERTICAL,M as default};
